[program:celery-worker-{{ django_hostname }}]
command={{ django_home_dir }}/vexec {{ django_venv_dir }}/bin/celery
    worker
    -A django_bpp.celery_tasks
    -c 1
    --pidfile={{ django_home_dir }}/celeryworker.pid
user={{ django_user }}
autostart=true
autorestart=true
numprocs=1
environment=USER="{{ django_user }}"
stdout_logfile={{ supervisor_logdir }}/{{ django_project_name }}/{{ django_hostname }}/celery-worker-stdout
stderr_logfile={{ supervisor_logdir }}/{{ django_project_name }}/{{ django_hostname }}/celery-worker-stderr
directory={{ django_home_dir }}

[program:listen-cachequeue-{{ django_hostname }}]
command={{ django_home_dir }}/vexec bpp-manage.py listen_cachequeue
user={{ django_user }}
autostart=true
autorestart=true
numprocs=1
environment=USER="{{ django_user }}"
stdout_logfile={{ supervisor_logdir }}/{{ django_project_name }}/{{ django_hostname }}/listen-cachequeue-stdout
stderr_logfile={{ supervisor_logdir }}/{{ django_project_name }}/{{ django_hostname }}/listen-cachequeue-stderr
directory={{ django_home_dir }}

[program:celery-beat-{{ django_hostname }}]
command={{ django_home_dir }}/vexec {{ django_venv_dir }}/bin/celery
    beat
    -A django_bpp.celery_tasks
    --pidfile={{ django_home_dir }}/celerybeat.pid
    -s {{ django_home_dir }}/celerybeat-schedule
user={{ django_user }}
autostart=true
autorestart=true
numprocs=1
environment=USER="{{ django_user }}"
stdout_logfile={{ supervisor_logdir }}/{{ django_project_name }}/{{ django_hostname }}/celery-beat-stdout
stderr_logfile={{ supervisor_logdir }}/{{ django_project_name }}/{{ django_hostname }}/celery-beat-stderr
directory={{ django_home_dir }}

[fcgi-program:appserver-{{ django_hostname }}]
user={{ django_user }}
autostart=true
autorestart=true
environment=USER="{{ django_user }}"
directory={{ django_home_dir }}
socket=tcp://localhost:{{ django_appserver_port }}
numprocs=4
process_name=uvicorn-%(process_num)d
command={{ django_home_dir }}/vexec {{ django_venv_dir }}/bin/uvicorn --fd 0 django_bpp.asgi:application
stdout_logfile={{ supervisor_logdir }}/{{ django_project_name }}/{{ django_hostname }}/appserver-stdout
stderr_logfile={{ supervisor_logdir }}/{{ django_project_name }}/{{ django_hostname }}/appserver-stderr
